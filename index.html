<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>وثيقة التطبيع | SYSTEM ONLINE</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
  <script src="data.js"></script>

  <style>
    :root {
      --bg: #000000;
      --card-bg: rgba(10, 10, 10, 0.85);
      --text: #ffffff;
      --muted: #888888;
      --green: #00FF41; /* Matrix Green */
      --accent: #149954; /* Palestine Green */
      --red: #E4312B;
      --gold: #D4AF37;
      --purple: #8A2BE2;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Tajawal', sans-serif;
      background-color: var(--bg);
      color: var(--text);
      overflow-x: hidden;
      min-height: 100vh;
    }

    /* --- Matrix Canvas Background --- */
    #matrix-bg {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      z-index: -1;
      opacity: 0.6;
    }

    /* --- Top Header Bar --- */
    .top-bar {
      position: fixed;
      top: 0; left: 0; width: 100%;
      height: 6px;
      background: linear-gradient(90deg, #000 25%, #fff 25%, #fff 50%, var(--accent) 50%, var(--accent) 75%, var(--red) 75%);
      z-index: 999;
    }

    /* --- Navigation --- */
    .nav-container {
      position: fixed;
      top: 6px; left: 0; width: 100%;
      background: rgba(0,0,0,0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid #222;
      z-index: 100;
      padding: 10px 0;
    }

    .nav-scroll {
      display: flex;
      overflow-x: auto;
      justify-content: center; /* Center on desktop */
      gap: 5px;
      padding: 0 10px;
      -webkit-overflow-scrolling: touch; /* Smooth scroll on mobile */
    }
    .nav-scroll::-webkit-scrollbar { display: none; } /* Hide scrollbar */

    .nav-btn {
      background: transparent;
      border: 1px solid #333;
      color: var(--muted);
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 700;
      font-size: 0.85rem;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.3s;
    }

    .nav-btn:hover { color: #fff; border-color: #fff; }
    .nav-btn.active { background: var(--green); color: #000; border-color: var(--green); }

    /* --- Page Layout --- */
    .page {
      display: none;
      padding: 100px 20px 60px; /* Top padding for nav */
      max-width: 1200px;
      margin: 0 auto;
      animation: fadeIn 0.5s ease;
    }

    .page.active { display: block; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* --- Cards --- */
    .card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .card {
      background: var(--card-bg);
      border: 1px solid #333;
      border-radius: 12px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }

    .card:hover {
      border-color: var(--green);
      transform: translateY(-3px);
      box-shadow: 0 0 15px rgba(0, 255, 65, 0.1);
    }

    .card-title { font-size: 1.2rem; font-weight: 900; margin-bottom: 5px; }
    .card-sub { font-size: 0.85rem; color: var(--muted); }

    /* --- Modal --- */
    .modal-overlay {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.9);
      z-index: 200;
      display: flex; align-items: center; justify-content: center;
      padding: 20px;
      opacity: 0; pointer-events: none;
      transition: opacity 0.3s;
    }
    .modal-overlay.active { opacity: 1; pointer-events: all; }

    .modal-box {
      background: #0a0a0a;
      border: 1px solid var(--green);
      border-radius: 15px;
      width: 100%; max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
      padding: 30px;
      position: relative;
      transform: scale(0.9);
      transition: transform 0.3s;
    }
    .modal-overlay.active .modal-box { transform: scale(1); }

    .close-btn {
      position: absolute; top: 10px; left: 10px;
      background: #333; border: none; color: #fff;
      width: 30px; height: 30px; border-radius: 50%;
      cursor: pointer; font-weight: bold;
    }

    /* --- Section Headers --- */
    .section-title {
      font-size: 1.5rem;
      font-weight: 900;
      margin-bottom: 10px;
      border-right: 4px solid var(--green);
      padding-right: 15px;
    }
    .section-desc { color: var(--muted); margin-bottom: 20px; }

    /* --- Hero (Home) --- */
    .hero { text-align: center; padding: 50px 0; }
    .hero h1 { font-size: 3rem; font-weight: 900; text-shadow: 0 0 20px var(--green); margin-bottom: 15px; }
    .hero p { color: var(--muted); max-width: 600px; margin: 0 auto; }

    /* --- Donate Button --- */
    .donate-btn {
      position: fixed; bottom: 20px; left: 20px;
      background: #000; border: 1px solid var(--gold);
      color: var(--gold); padding: 10px 20px;
      border-radius: 30px; font-weight: bold;
      cursor: pointer; z-index: 50;
      display: flex; align-items: center; gap: 10px;
    }
  </style>
</head>
<body>

  <!-- Matrix Background Canvas -->
  <canvas id="matrix-bg"></canvas>

  <!-- Top Flag Bar -->
  <div class="top-bar"></div>

  <!-- Navigation -->
  <nav class="nav-container">
    <div class="nav-scroll">
      <button class="nav-btn active" onclick="showPage('home')">الرئيسية</button>
      <button class="nav-btn" onclick="showPage('countries')">تاريخ الدول</button>
      <button class="nav-btn" onclick="showPage('palestine')">فلسطين</button>
      <button class="nav-btn" onclick="showPage('sovereignty')">السيادة المخطوفة</button>
      <button class="nav-btn" onclick="showPage('lies')">الأكاذيب المسيطرة</button>
    </div>
  </nav>

  <!-- PAGE: HOME -->
  <div id="page-home" class="page active">
    <div class="hero">
      <h1>SYSTEM://ONLINE</h1>
      <p>وثيقة تفاعلية متجددة توثق مواقف الدول العربية من القضية الفلسطينية والكيان الصهيوني.</p>
      <div style="margin-top: 30px;">
        <span style="border: 1px solid var(--green); padding: 10px 30px; border-radius: 50px; color: var(--green); font-weight: bold; letter-spacing: 2px;">
          FREE PALESTINE
        </span>
      </div>
    </div>
  </div>

  <!-- PAGE: COUNTRIES (History) -->
  <div id="page-countries" class="page">
    <div id="countries-container"></div>
  </div>

  <!-- PAGE: PALESTINE -->
  <div id="page-palestine" class="page">
    <div class="section-title" style="border-color: var(--gold); color: var(--gold);">فلسطين</div>
    <p class="section-desc">جوهر القضية وقلب الأمة النابض.</p>
    <div id="palestine-container" class="card-grid"></div>
  </div>

  <!-- PAGE: SOVEREIGNTY -->
  <div id="page-sovereignty" class="page">
    <div class="section-title" style="border-color: var(--purple); color: var(--purple);">السيادة المخطوفة</div>
    <p class="section-desc">أدوات التحكم الخفية في مصير الأمم.</p>
    <div id="sovereignty-container" class="card-grid"></div>
  </div>

  <!-- PAGE: LIES -->
  <div id="page-lies" class="page">
    <div class="section-title" style="border-color: var(--red); color: var(--red);">الأكاذيب المسيطرة</div>
    <p class="section-desc">مفاهيم زرعت في عقولنا لخدمة مصادر خفية.</p>
    <div id="lies-container" class="card-grid"></div>
  </div>

  <!-- Modal -->
  <div id="modal" class="modal-overlay" onclick="closeModal(event)">
    <div class="modal-box" onclick="event.stopPropagation()">
      <button class="close-btn" onclick="closeModal()">X</button>
      <div id="modal-content"></div>
    </div>
  </div>

  <!-- Donate Button -->
  <button class="donate-btn" onclick="alert('BTC: bc1qs642vuwxtwn5z926uuhnc6t33u42csdhes09c4')">
    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M5.5 13v1.25c0 .138.112.25.25.25h1a.25.25 0 0 0 .25-.25V13h.5v1.25c0 .138.112.25.25.25h1a.25.25 0 0 0 .25-.25V13h.5v1.25c0 .138.112.25.25.25h1a.25.25 0 0 0 .25-.25V13h.5a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-6a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h.5z"/><path d="M8 4a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0v-3A.5.5 0 0 1 8 4zm2 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0v-3A.5.5 0 0 1 10 4zm-4 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0v-3A.5.5 0 0 1 6 4z"/></svg>
    Donate
  </button>

  <script>
    // --- 1. MATRIX RAIN ANIMATION (Simplified & Clean) ---
    const canvas = document.getElementById('matrix-bg');
    const ctx = canvas.getContext('2d');
    
    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    const letters = "01";
    const fontSize = 14;
    let columns = canvas.width / fontSize; 
    let drops = Array(Math.floor(columns)).fill(1);

    function drawMatrix() {
      ctx.fillStyle = "rgba(0, 0, 0, 0.1)"; // Fade effect
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      ctx.fillStyle = "#00FF41"; // Matrix Green
      ctx.font = fontSize + "px courier";

      for (let i = 0; i < drops.length; i++) {
        const text = letters.charAt(Math.floor(Math.random() * letters.length));
        ctx.fillText(text, i * fontSize, drops[i] * fontSize);

        if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
          drops[i] = 0;
        }
        drops[i]++;
      }
    }
    setInterval(drawMatrix, 50);

    // --- 2. DATA RENDERING LOGIC ---
    
    // Check if data exists
    if (typeof countriesData === 'undefined') {
      document.body.innerHTML = "<h1 style='color:red; text-align:center; margin-top:50px;'>خطأ: لم يتم تحميل ملف البيانات (data.js)</h1>";
    } else {
      renderAllData();
    }

    function renderAllData() {
      // A. Render Countries (Levels 1-5)
      const countriesContainer = document.getElementById('countries-container');
      for (let i = 1; i <= 5; i++) {
        const levelInfo = levels[i];
        const items = countriesData.filter(c => c.level === i);
        
        if (items.length === 0) continue;

        let html = `
          <div style="margin-bottom: 40px;">
            <div class="section-title">${levelInfo.title}</div>
            <p class="section-desc">${levelInfo.desc}</p>
            <div class="card-grid">
        `;

        items.forEach(item => {
          html += createCardHTML(item);
        });

        html += `</div></div>`;
        countriesContainer.innerHTML += html;
      }

      // B. Render Palestine (ID 100)
      const palestineContainer = document.getElementById('palestine-container');
      const palestineData = countriesData.filter(c => c.id === 100);
      palestineData.forEach(item => palestineContainer.innerHTML += createCardHTML(item));

      // C. Render Sovereignty (IDs 101-199)
      const sovereigntyContainer = document.getElementById('sovereignty-container');
      const sovereigntyData = countriesData.filter(c => c.id >= 101 && c.id < 200);
      sovereigntyData.forEach(item => sovereigntyContainer.innerHTML += createCardHTML(item));

      // D. Render Lies (IDs 200+)
      const liesContainer = document.getElementById('lies-container');
      const liesData = countriesData.filter(c => c.id >= 200);
      liesData.forEach(item => liesContainer.innerHTML += createCardHTML(item));
    }

    function createCardHTML(item) {
      return `
        <div class="card" onclick="openModal(${item.id})">
          <div class="card-title">${item.name}</div>
          <div class="card-sub">${item.subtitle || ''}</div>
        </div>
      `;
    }

    // --- 3. NAVIGATION & MODAL LOGIC ---

    window.showPage = function(pageId) {
      // Hide all pages
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      // Show selected
      document.getElementById('page-' + pageId).classList.add('active');
      
      // Update Nav Buttons
      document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
      event.target.classList.add('active'); 
      
      window.scrollTo(0, 0); // Scroll to top
    }

    window.openModal = function(id) {
      const item = countriesData.find(c => c.id === id);
      if (!item) return;

      const modal = document.getElementById('modal');
      const content = document.getElementById('modal-content');
      
      content.innerHTML = `
        <h2 style="font-size: 1.8rem; font-weight: 900; margin-bottom: 10px; color: var(--green);">${item.name}</h2>
        <p style="color: var(--muted); margin-bottom: 20px;">${item.subtitle || ''}</p>
        <div style="line-height: 1.8; color: #ddd;">
          ${item.events.replace(/\n/g, '<br>')}
        </div>
      `;
      
      modal.classList.add('active');
    }

    window.closeModal = function(e) {
      // If passed explicitly or clicked overlay
      const modal = document.getElementById('modal');
      modal.classList.remove('active');
    }
    
    // Close modal with Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeModal();
    });

  </script>
</body>
</html>
